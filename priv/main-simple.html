<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Biosensor UI</title>
        <style type="text/css">
            #header {
                border-bottom: 1px solid black;
                margin-bottom: 7px;
            }
            #tab-headers .selected {
                background-color: #DDD;
            }
            .tab-header {
                border: 1px solid grey;
                padding: 1px 10px;
                cursor: pointer;
            }
            .tab-body {
                border: 1px solid grey;
                padding: 10px;
            }
            table {
                border-spacing: 0px;
                border-collapse: collapse;
                margin: 5px;
            }
            table caption {
                text-align: left;
                font-weight: bold;
            }
            th, td {
                border: 1px solid black;
                padding: 1px 5px;
            }
            th {
                background: #DDD;
            }


            svg {
                border: 1px solid #EEE;
                margin-right: 20px;
            }
            line.axis { stroke: #AAA; stroke-width: 2}
            text.axis { color: #000; }
            rect.subarea {fill: #fff; stroke: #000; stroke-width: 1px; }
            rect.subarea:hover {fill: #ddf;}
            rect.bound {fill: #fff; stroke-width: 0px; }
            rect.bound:hover {fill: #ddF;}
            #geom-fig { float: left; }
            /*
            #geom-reac { float:right; }
            #geom-spec { clear:right; float:right; }
            */
        </style>
        <script src="jquery.js"></script>
        <script type="text/javascript">
            var model = {
                "axes": [
                    {"name": "r", "points": ["r0", "r1", "r2"]},
                    {"name": "z", "points": ["z0", "z1", "z2", "z3", "z4"]}
                ],
                "species": [
                    {"name": "S"},
                    {"name": "P"},
                    {"name": "E"}
                ],
                "reactions": [
                    {"name": "R1"},
                    {"name": "R2"},
                    {"name": "R3"}
                ],
                "compartments": [
                    {"name": "Nernst diffusion layer"},
                    {"name": "Perforated membrane"},
                    {"name": "Enzyme"},
                    {"name": "Selective membrane"}
                ],
                "params": [
                    {"name": "p0", "value": "v0", "dim": "m/s"},
                    {"name": "p1", "value": "v1", "dim": "m/s"},
                    {"name": "p2", "value": "v2", "dim": "m/s"},
                    {"name": "p3", "value": "v3", "dim": "m/s"},
                    {"name": "p4", "value": "v4", "dim": "m/s"},
                    {"name": "p5", "value": "v5", "dim": "m/s"},
                    {"name": "p6", "value": "v6", "dim": "m/s"},
                    {"name": "p7", "value": "v7", "dim": "m/s"},
                    {"name": "p8", "value": "v8", "dim": "m/s"},
                    {"name": "p9", "value": "v9", "dim": "m/s"}
                ]
            };
            function activateTab(tabHeader, tabName) {
                $("#tab-headers .tab-header").removeClass("selected");
                $(tabHeader).addClass("selected");
                $("#tab-bodies .tab-body").hide();
                $("#tab-bodies #" + tabName).show();
            }
            function renderParams() {
                var paramsRows = "";
                for (var i = 0; i < model.params.length; i++) {
                    var param = model.params[i];
                    paramsRows += "<tr>";
                    paramsRows += "<td>" + param.name + "</td>";
                    paramsRows += "<td>" + param.value + "</td>";
                    paramsRows += "<td>" + param.dim + "</td>";
                    paramsRows += "</tr>";
                }
                $("#tab-params table tbody").html(paramsRows);
            }
            function renderGeometry() {
                var sizeX = 400;        // image size
                var sizeY = 400;        // image size
                var axisOffset = 30;    // axis offset
                var maxX = sizeX - 2 * axisOffset;
                var maxY = sizeY - 2 * axisOffset;
                var x = function (x) { return axisOffset + x; };
                var y = function (y) { return sizeY - axisOffset - y; };
                var img = "<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='" + sizeX + "' width='" + sizeY + "'>";
                img += "<defs>";
                img += "  <marker id='Triangle' viewBox='0 0 10 10' refX='10' refY='5' markerUnits='strokeWidth' markerWidth='10' markerHeight='5' orient='auto'>";
                img += "    <path d='M 0 0 L 10 5 L 0 10 L 6 5 z' />";
                img += "  </marker>";
                img += "</defs>";
                img += "<line class='axis' x1='" + x(0) + "' y1='" + y(0) + "' x2='" + x(maxX) + "' y2='" + y(0)    + "' marker-end='url(#Triangle)'/>";
                img += "<line class='axis' x1='" + x(0) + "' y1='" + y(0) + "' x2='" + x(0)    + "' y2='" + y(maxY) + "' marker-end='url(#Triangle)'/>";
                img += "<text class='axis' x='" + x(-15) + "' y='" + y(-15) + "'>0</text>"
                if (model.axes.length > 0) {
                    var axis = model.axes[0];
                    img += "<text class='axis' x='" + x(maxX) + "' y='" + y(-15) + "'>" + axis.name + "</text>"
                    if (axis.points.length > 1) {
                        var step = maxX * 0.9 / (axis.points.length - 1);
                        for (var i = 0; i < axis.points.length; i++) {
                            img += "<line class='axis' x1='" + x(step * i) + "' y1='" + y(5) + "' x2='" + x(step * i) + "' y2='" + y(-5) + "'/>";
                            img += "<text class='axis' x='" + x(step * i) + "' y='" + y(-20) + "'>" + axis.points[i] + "</text>";
                        }
                    }
                }
                if (model.axes.length > 1) {
                    var axis = model.axes[1];
                    img += "<text class='axis' x='" + x(-15) + "' y='" + y(maxY) + "'>" + axis.name + "</text>"
                    if (axis.points.length > 1) {
                        var step = maxY * 0.9 / (axis.points.length - 1);
                        for (var i = 0; i < axis.points.length; i++) {
                            img += "<line class='axis' x1='" + x(5) + "' y1='" + y(step * i) + "' x2='" + x(-5) + "' y2='" + y(step * i) + "'/>";
                            img += "<text class='axis' x='" + x(-25) + "' y='" + y(step * i) + "'>" + axis.points[i] + "</text>";
                        }
                    }
                }
                for (var j = 0; j < model.axes[1].points.length - 1; j++) {
                    for (var i = 0; i < model.axes[0].points.length - 1; i++) {
                        var stepX = maxX * 0.9 / (model.axes[0].points.length - 1);
                        var stepY = maxY * 0.9 / (model.axes[1].points.length - 1);
                        img += "<rect class='subarea' ";
                        img += "x='" + x(stepX * i + 5) + "' "
                        img += "y='" + y(stepY * (j+1) - 5) + "'"
                        img += "width='" + (stepX -10) + "'"
                        img += "height='" + (stepY -10) + "'"
                        img += "/>";
                        if (j == 0) {
                            img += "<rect class='bound' ";
                            img += "x='" + x(stepX * i + 5) + "' "
                            img += "y='" + y(stepY * (-1+1) + 5) + "'"
                            img += "width='" + (stepX -10) + "'"
                            img += "height='" + (4) + "'"
                            img += "/>";
                        }
                        img += "<rect class='bound' ";
                        img += "x='" + x(stepX * i + 5) + "' "
                        img += "y='" + y(stepY * (j+1) + 5) + "'"
                        img += "width='" + (stepX -10) + "'"
                        img += "height='" + (10) + "'"
                        img += "/>";
                        if (i == 0) {
                            img += "<rect class='bound' ";
                            img += "x='" + x(stepX * (-1+1) + 1) + "'"
                            img += "y='" + y(stepY * (j+1) - 5) + "' "
                            img += "width='" + (4) + "'"
                            img += "height='" + (stepY -10) + "'"
                            img += "/>";
                        }
                        img += "<rect class='bound' ";
                        img += "x='" + x(stepX * (i+1) - 5) + "'"
                        img += "y='" + y(stepY * (j+1) - 5) + "' "
                        img += "width='" + (10) + "'"
                        img += "height='" + (stepY -10) + "'"
                        img += "/>";
                    }
                }
                img += "</svg>";
                $("#geom-fig").html(img);
            }
            function renderGeomCompartments() {
                var rows = "";
                for (var i = 0; i < model.compartments.length; i++) {
                    var comp = model.compartments[i];
                    rows += "<tr>";
                    rows += "<td>" + comp.name + "</td>";
                    rows += "</tr>";
                }
                $("#geom-comp tbody").html(rows);
            }
            function renderGeomSpecies() {
                var rows = "";
                for (var i = 0; i < model.species.length; i++) {
                    var spec = model.species[i];
                    rows += "<tr>";
                    rows += "<td>" + spec.name + "</td>";
                    rows += "<td><input type='text' value='0'/></td>";
                    rows += "<td><input type='text' value='0'/></td>";
                    rows += "</tr>";
                }
                $("#geom-spec tbody").html(rows);
            }
            function renderGeomReactions() {
                var rows = "";
                for (var i = 0; i < model.reactions.length; i++) {
                    var reac = model.reactions[i];
                    rows += "<tr>";
                    rows += "<td>" + reac.name + "</td>";
                    rows += "</tr>";
                }
                $("#geom-reac tbody").html(rows);
            }
            $(document).ready(function() {
                $("#tab-headers .tab-header")[1].click();
                renderParams();
                renderGeometry();
                renderGeomCompartments();
                renderGeomSpecies();
                renderGeomReactions();
            });
        </script>
    </head>
    <body>
        <div id="header">
            Model: ...
        </div>
        <div id="tabs">
            <div id="tab-headers">
                <span class="tab-header" onclick="activateTab(this, 'tab-main')">Main</span>
                <span class="tab-header" onclick="activateTab(this, 'tab-geometry')">Geometry</span>
                <span class="tab-header" onclick="activateTab(this, 'tab-reactions')">Reactions</span>
                <span class="tab-header" onclick="activateTab(this, 'tab-params')">Parameters</span>
                <span class="tab-header" onclick="activateTab(this, 'tab-sim')">Simulations</span>
            </div>
            <div id="tab-bodies">
                <div class="tab-body" id="tab-main">
                    Main
                </div>
                <div class="tab-body" id="tab-geometry">
                    <div id="geom-fig"></div>
                    <table id="geom-comp">
                        <caption>Compartments</caption>
                        <thead><tr><th>Name</th></tr></thead>
                        <tbody></tbody>
                    </table>
                    <table id="geom-spec">
                        <caption>Species</caption>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Diffusion coefficient</th>
                                <th>Initial concentration</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <table id="geom-reac">
                        <caption>Reactions</caption>
                        <thead><tr><th>Name</th></tr></thead>
                        <tbody></tbody>
                    </table>
                    <div style="clear:both;"></div>
                </div>
                <div class="tab-body" id="tab-reactions">
                    R
                </div>
                <div class="tab-body" id="tab-params">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Value</th>
                                <th>Dimension</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div class="tab-body" id="tab-sim">
                    S
                </div>
            </div>
        </div>
    </body>
</html>